# General information

ProbCompCert ties directly into CompCert by generating Clight code and
makes heavy use of most of the generic compiler libraries of CompCert
including: Coqlib, Maps, Integers, Floats, Errors, AST, Linking,
Values, Memory, Globalenvs, Smallstep, Op, Ctypes, and Clight.

Documentation on these libraries can be found in [CompCert's commented
Coq development](https://compcert.org/doc/index.html)

The [runtime](runtime) directory contains the C implementation of the
runtime and of the standard library.

The [tests](tests) directory contains Stan example programs and
development tools.

# Commented Coq development

## Languages, syntax and semantics:

Similar to CompCert, the compiler makes use of multiple languages. In
CompCert, to a large extent, every syntax is asscociated with a single
semantics, and a compiler pass that removes a feature maps to a new
language. An exception is Clight which comes with two semantics.

In ProbCompCert, at least for now, several compiler pass remain in the
same language despite removing a feature. As a result, some languages
are associated with multiple semantics.

* [Stan](Stan.v): The Stan language, generated by the parser. This
  language does not currenlty have a semantics.

* [Stanlight](Stanlight.v): A subset of Stan describing valid
   Stan programs. In principle, any Stan program could be written in
   Stanlight.

* [CStan](CStan.v): an extension of Clight with probabilistic
  programming features. Includes features such as structures which are
  necessary for compilation.

## Parsing

The parser uses Menhir's verified parsing tools. The verified parser
was largely developped by Brian Ward as part of his [honor's
thesis](https://www.bc.edu/content/dam/bc1/schools/mcas/cs/pdf/honors-thesis/Ward_Brian_Thesis.pdf)
at Boston College.

* [Lexer specification](Lexer.mll)
* [Parser specification](Parser.vy)
* [Error messages](error.messages)

## Compiler passes

| Pass | Source | Target | Code | Proof |
| ---- | ------ | ------ | ---- | ----- |
| Reparameterization | Stanlight | Stanlight | [Reparameterization](Reparameterization.v) | [Reparameterizationproof](Reparameterizationproof.v) 

## All together

* [Scompiler](Scompiler.v): defines the overall compilation and proof of semantics preservation